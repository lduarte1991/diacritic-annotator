var _ref,__bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function r(){this.constructor=e}for(var n in t){if(__hasProp.call(t,n))e[n]=t[n]}r.prototype=t.prototype;e.prototype=new r;e.__super__=t.prototype;return e};Annotator.Plugin.Diacritics=function(e){function t(e,n){this.pluginSubmit=__bind(this.pluginSubmit,this);this.updateDiacritics=__bind(this.updateDiacritics,this);this.updateViewer=__bind(this.updateViewer,this);this.getDiacritics=__bind(this.getDiacritics,this);this.getPos=__bind(this.getPos,this);this.putMarkatLocation=__bind(this.putMarkatLocation,this);this.updateEditorForDiacritics=__bind(this.updateEditorForDiacritics,this);this.options=n;this.diacriticmarks=this.getDiacritics();_ref=t.__super__.constructor.apply(this,arguments);return _ref}__extends(t,e);t.prototype.options=null;t.prototype.diacriticmarks=null;t.prototype.field=null;t.prototype.input=null;t.prototype.pluginInit=function(){console.log("Diacritics-pluginInit");if(!Annotator.supported()){return}var e=this.diacriticmarks;var t=this;$.each(e,function(e){t.field=t.annotator.editor.addField({type:"checkbox",label:Annotator._t(e),submit:t.pluginSubmit})});var n=this.annotator.viewer.addField({load:this.updateViewer});this.annotator.subscribe("annotationsLoaded",this.updateDiacritics);this.annotator.subscribe("annotationUploaded",this.updateDiacritics);this.annotator.subscribe("annotationDeleted",this.updateDiacritics);this.annotator.subscribe("annotationEditorShown",this.updateEditorForDiacritics,this.field);var t=this;$(window).resize(function(){t.updateDiacritics()});return this.input=$(this.field).find(":input")};t.prototype.pluginSubmit=function(e,t){var n=$(this.field).find(":input");var r=this;$.each(n,function(e){if(typeof t.tags!="undefined"){var i=$.inArray(n[e].placeholder,t.tags);if(i!=-1){t.tags.splice(i,1);if(typeof $($(".annotator-wrapper")[0]).find("div."+t.id)[0]!="undefined"){$($(".annotator-wrapper")[0]).find("div."+t.id)[0].remove()}else{$($(".annotator-wrapper")[0]).find("div.undefined")[0].remove()}}if(n[e].checked==true){t.tags.push(n[e].placeholder);r.putMarkatLocation(t,n[e].placeholder)}}else{if(n[e].checked==true){t["tags"]=[n[e].placeholder];r.putMarkatLocation(t,n[e].placeholder)}}})};t.prototype.putMarkatLocation=function(e,t){var n=this.getPos(e.highlights[0]);var r=this.diacriticmarks[t][1];var i=this.diacriticmarks[t][0];var s=document.createElement("div");var o="mark "+e.id;s.setAttribute("class",o);if(r=="top"){$(s).css("top",""+(n.y-5)+"px")}else if(r=="bottom"){$(s).css("top",""+(n.y+n.height-5)+"px")}else{$(s).css("top",""+n.y+"px")}$(s).css("left",""+(n.x+n.width/2-10)+"px");$(s).css("background-image","url("+i+")");$(".annotator-wrapper")[0].appendChild(s)};t.prototype.getDiacritics=function(){if(typeof this.options.diacritics!="undefined"){var e=this;var t={},n=this.options.diacritics.split(",");n.forEach(function(e){var n=e.split(";");t[n[0]]=[n[1],n[2]]});return t}return{}};t.prototype.getPos=function(e){var t=$(e).offset();return{x:t.left,y:t.top-$($(".annotator-wrapper")[0]).offset().top,width:$(e).width(),height:$(e).height()}};t.prototype.updateDiacritics=function(){$(".mark").remove();var e=this.annotator.plugins["Store"].annotations;var t=this;e.forEach(function(e){$.each(t.diacriticmarks,function(n){if($.inArray(n,e.tags)!=-1){t.putMarkatLocation(e,n)}})})};t.prototype.updateViewer=function(e,t){$(e).remove()};t.prototype.updateEditorForDiacritics=function(e,t){if(typeof t.tags=="undefined"){return}var n=this;var r=$(this.field).find(":input");var i={};$.each(r,function(e){r[e].checked=false;i[r[e].placeholder]=r[e]});t.tags.forEach(function(e){if(typeof n.diacriticmarks[e]!="undefined"){i[e].checked=true}})};return t}(Annotator.Plugin)